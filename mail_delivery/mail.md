# Final Project: Mail Delivery

The final project involves a combination of the path following implemented in lab 3 and Bayesian Localization to localize the robot and have it stop at specified locations to drop off mail as necessary.

A closed-loop path was drawn on the floor in the same black tape used previously, and offices wre marked using sheets of coloured paper that were placed on top of the path. The robot was meant to use the different colours of paper at different locations to determine where it was, and stop at an office if there was a delivery to be made to that office.

The line-following algorithm from lab 3 was used without changes, and teh same camera was to be used to determine the colour of the paper on which the robot was standing. It was suggested by the course instructors that we take the average RGB values of the entire FOV of the camera and use it to deremine whether the robot was standing on yellow/red/green/blue paper or on a section of the path that had no paper on it. The issue was that teh camera built into the TurtleBots is of relatively low quality, so we encountered a couple issues:

First, the robot would try to find a line of tape when it was on a sheet of paper, which had no line drawn on it, and the unexpected lack of line caused the robot to lose the path entirely. The average RGB values of the yellow sheet of paper were too close to those of the floor and tape, so we could not determine when to apply path following based soleley on the average RGB values of the camera FOV. To avoid this, we determined the difference in the darkest and lightest column of pixels in the camera's FOV. We would expect the difference to be low when the entire FOV was a single colour, but when following a line, the difference would be high since the tape is much darker than the floor behind it. The line following algorithm was applied only when the difference was above a certain threshold. When the difference was below the threshold, the TurtleBot was programmed to go in a straight line until the difference rose above the threshold again (i.e. a line is detected). Intially, we took the average darkness of all pixels in each column, but since this was too computationally expensive, we decided to consider a single row of pixels for this computation instead. This additional consideration was developed by our team and we had to adjust the camera node given by the course instructors to implement this functionality (the modified code is included in camera_rgb.py).

The second issue was that certain colours had very similar RGB values as perceived by the TurtleBot's camera (which, again, was not of particularly impressive quality). We had to find an effective way to determine which of the four colours we were standing on. We began by measuring the average values read by the TurtleBot for each colour, stored this data in an array in our python code, and in each iteration, needed to find out which of the colours our measured RGB values were 'closest' to. We decided on a sum of sqaures of differences approach, that is, we squared the difference between the expected/observed values of RGB and summed them to determine which of the four colours had teh smallest sum.

The final issue to solve was to implement the Bayesian Localization algorithm. Our system had one state variable to update (which office the TurtleBot is located at) so it was not difficult to implement nor was it computationally expensive (there were a total of 11 possible states for our TurtleBot). The iterative procedure for Bayesian Localization was not run continuously, but each time a new sheet of paper was enountered, at which point in time the observed colour was used as the most recent measurement to update the predicted state.

In the final tests, our Mail Delivery System was able to stop at any selected offices, detect those offices successfully, and stop at the given destinations to drop off mail. Additionally, the functionality was not conditional on having the TurtleBot begin at a specific location on the path. The TurtleBot's initial state probability distribution was uniform, and regardless of where on the track it started, it could localize itself with more than 90% certainty in less than one full lap.
